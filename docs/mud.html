<!DOCTYPE html>

<html>
<head>
  <title>Mud</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap for-h1">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <h1>Mud</h1>

            </div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>Mud is a simple template framework for HTML documents
(primarily HTML5) written in pure CoffeeScript.</p>
<h2>Tags</h2>

            </div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>This section defines all of the supported tags in <code>Mud</code>.
Each tag is listed as either <em>void</em> or <em>normal</em>.
<em>Void</em> tags are those that are self-closing,
while <em>normal</em> tags require a closing tag.</p>
<p>An example of a void tag would be the break tag,
<code>&lt;br&gt;</code>, while an example of a normal tag would be
the paragraph tag, <code>&lt;p&gt;&lt;/p&gt;</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>TAGS =</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <ul>
<li>Void tags</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>	void: '''
	area base br col command embed hr img input
	keygen link meta param source track wbr
	'''.split /\s+/</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <ul>
<li>Normal tags</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>	normal: '''
	script style textarea title html head body
	nav header footer aside article section
	h1 h2 h3 h4 h5 h6 hgroup div p pre blockquote
	hr ul ol li dl dt dd span a em strong b i u
	s mark small del ins sup sub dfn code var samp
	kbd q cite ruby rp rt br wbr bdo bdi table caption
	tr td th thead tfoot tbody colgroup col img
	figcaption figure map area video audio source track
	noscript object param embed iframe canvas abbr address
	meter progress time form button input textarea select
	option optgroup label fieldset legend datalist menu
	output details summary
	'''.split /\s+/</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>The <code>STRINGIFY</code> function is a helper that
converts a function, object, or string into
a string that is safe for HTML display.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">STRINGIFY</span></span> = ( item ) -&gt;
	<span class="keyword">switch</span> <span class="keyword">typeof</span> item
		<span class="keyword">when</span> <span class="string">'function'</span>
			item()
		<span class="keyword">when</span> <span class="string">'object'</span>
			JSON.stringify item
		<span class="keyword">else</span>
			ESCAPE item.toString()</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>The <code>ESCAPE</code> function is a helper that
makes a string safe for HTML display.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">ESCAPE</span></span> = ( text ) -&gt;
	text
		.replace( <span class="regexp">/&gt;/g</span>, <span class="string">'&amp;gt;'</span> )
		.replace( <span class="regexp">/&lt;/g</span>, <span class="string">'&amp;lt;'</span> )
		.replace( <span class="regexp">/"/g</span>, <span class="string">'&amp;quot;'</span> )</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap for-h1">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <h1>Tag</h1>

            </div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>The <code>Tag</code> class represents a single tag.
It&#39;s used internally to print the opening,
closing, and content sections of an HTML
element.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="class"><span class="keyword">class</span> <span class="title">Tag</span></span>
	constructor: ( <span class="property">@name</span>, <span class="property">@void</span> = <span class="literal">no</span> ) -&gt;

	open: ( attributes ) -&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>All tags open the same way.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		result = <span class="string">"&lt;<span class="subst">#{ @name }</span>"</span></pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>To write the attributes of a tag, we
stringify each value and create an HTML-safe
map to insert into the opening section.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		<span class="keyword">if</span> <span class="keyword">typeof</span> attributes <span class="keyword">is</span> <span class="string">'object'</span>
			map = <span class="keyword">do</span> -&gt; <span class="keyword">for</span> own name, value <span class="keyword">of</span> attributes
				<span class="string">"<span class="subst">#{ name }</span>='<span class="subst">#{ STRINGIFY( value )
					.replace( /\\/g, '\\\\' )
					.replace( /'/g, '\\\'' )}</span>'"</span>
			result += <span class="string">' '</span> + map.join <span class="string">' '</span></pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>All opening tags close the same way.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		result += <span class="string">'&gt;'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>Unless a tag is <em>void</em> (and therefore doesn&#39;t need
to be closed), this writes the closing tag.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	close: -&gt;
		<span class="keyword">unless</span> <span class="property">@void</span>
			<span class="string">"&lt;/<span class="subst">#{ @name }</span>&gt;"</span></pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>The content section is written by stringifying
the given content into an HTML-safe string.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	content: ( attributes, content ) -&gt;
		<span class="keyword">unless</span> <span class="keyword">typeof</span> attributes <span class="keyword">is</span> <span class="string">'object'</span>
			content = attributes

		<span class="keyword">unless</span> <span class="property">@void</span>
			<span class="string">"<span class="subst">#{ STRINGIFY content }</span>"</span>
		<span class="keyword">else</span>
			<span class="string">''</span></pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>The doctype is a special type of tag
with the format <code>&lt;!DOCTYPE html&gt;</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="class"><span class="keyword">class</span> <span class="title">DocType</span> <span class="keyword">extends</span> <span class="title">Tag</span></span>
	constructor: -&gt;
		<span class="property">@name</span> = <span class="string">'doctype'</span>
		<span class="property">@void</span> = <span class="literal">yes</span>

	open: ( args... ) -&gt; <span class="string">"&lt;!DOCTYPE <span class="subst">#{ args.join ' ' }</span>&gt;"</span>

	content: -&gt; <span class="string">''</span>

	close: -&gt; <span class="string">''</span></pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap for-h1">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <h1>Template</h1>

            </div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>The <code>Template</code> is the main class of <code>Mud</code> and what users
will receive as the module. It defines one function,
<code>render</code>, which accepts a callback that it uses to generate
a string.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="class"><span class="keyword">class</span> <span class="title">Template</span></span>
	level = <span class="number">0</span>

	constructor: -&gt;
		<span class="property">@tags</span> = [ <span class="keyword">new</span> DocType() ]
		<span class="property">@tags</span>.push <span class="keyword">new</span> Tag tag, <span class="literal">yes</span> <span class="keyword">for</span> tag <span class="keyword">in</span> TAGS.<span class="reserved">void</span>
		<span class="property">@tags</span>.push <span class="keyword">new</span> Tag tag <span class="keyword">for</span> tag <span class="keyword">in</span> TAGS.normal</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p><code>render</code> accepts a callback and a model. The callback
is invoked in the context of all of <code>Mud</code>&#39;s helper
functions, so they are available bound to <code>this</code> or <code>@</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	render: ( action, model ) -&gt;
		writers = { model }
		result = []
		content = <span class="literal">no</span></pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>Some helper functions for pretty printing our tags.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		<span class="function"><span class="title">add</span></span> = ( arg ) -&gt; result.push arg

		<span class="function"><span class="title">newline</span></span> = -&gt; add <span class="string">'\n'</span>

		<span class="function"><span class="title">tab</span></span> = -&gt; add <span class="string">'\t'</span>

		<span class="function"><span class="title">indent</span></span> = -&gt;
			tab() <span class="keyword">for</span> i <span class="keyword">in</span> [<span class="number">0.</span>..level]</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>A function is bound for each tag that
creates properly indented markup.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		<span class="keyword">for</span> tag <span class="keyword">in</span> <span class="property">@tags</span>
			<span class="keyword">do</span> ( tag ) -&gt;
				writers[tag.name] = ( args... ) -&gt;
					newline() <span class="keyword">unless</span> content <span class="keyword">or</span> level <span class="keyword">is</span> <span class="number">0</span>
					indent() <span class="keyword">unless</span> content
					add tag.open args...

					newline()
					level += <span class="number">1</span>
					indent()
					content = <span class="literal">yes</span>
					result.push tag.content args...
					content = <span class="literal">no</span>

					newline()
					level -= <span class="number">1</span>
					indent()
					result.push tag.close args...
					<span class="string">''</span>

		action.call writers
		result.join <span class="string">''</span>

Mud = <span class="keyword">new</span> Template()</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>If we&#39;re running in the browser, our <code>exports</code> object
should be <code>window</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="keyword">if</span> window?
	window.Mud = Mud
<span class="keyword">else</span>
	module.exports = Mud</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
